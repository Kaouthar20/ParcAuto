{% extends 'base.html.twig' %}

{% block title %}Hello MissionController!

{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
    .btn-buy-now {

    }
body{
  height: 100vh;
}
td {
  padding: 0 !important;
  text-align: center;
  }
    .menu-nav {
       
        display: flex;
        justify-content: space-between;
      }
      
      .menu-item {
        color: #FCC;
        padding: 3px;
      }
      
      .three-dots:after {
        cursor: pointer;
        color: #444;
        content: '\2807';
        font-size: 20px;
        padding: 0 5px;
      }
      
      a {
        text-decoration: none;
        color: white;
      }
      
      a div {
        padding: 2px;
      }
      
      .dropdown {
        position: absolute;
        right: 10px;
        background-color: #66D;
        
        outline: none;
        opacity: 0;
        z-index: -1;
        max-height: 0;
        transition: opacity 0.1s, z-index 0.1s, max-height: 5s;
      }
      
      .dropdown-container:focus {
        outline: none;
      }
      
      .dropdown-container:focus .dropdown {
        opacity: 1;
        z-index: 100;
        max-height: 100vh;
        transition: opacity 0.2s, z-index 0.2s, max-height: 0.2s;
      }
      .tooltip {
  position: relative;
  display: inline-block;
  border-bottom: 1px dotted black;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;

  /* Position the tooltip */
  position: absolute;
  z-index: 1;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
}
i{
  cursor:pointer;
}

.tabMission{
     padding: 10px 25px 0 25px
  /* height: 100vh; */
}
input[type=search] {

  margin-bottom:15px;
}
.swal2-backdrop-show{
  z-index: 99999;
}
</style>
<!DOCTYPE html>

<!-- =========================================================
* Sneat - Bootstrap 5 HTML Admin Template - Pro | v1.0.0
==============================================================

* Product Page: https://themeselection.com/products/sneat-bootstrap-html-admin-template/
* Created by: ThemeSelection
* License: You must have a valid license purchased in order to legally use the theme for your project.
* Copyright ThemeSelection (https://themeselection.com)

=========================================================
 -->
<!-- beautify ignore:start -->
<html
  lang="en"
  class="light-style layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="../assets/"
  data-template="vertical-menu-template-free"
>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>Dashboard - Analytics | Sneat - Bootstrap 5 HTML Admin Template - Pro</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon/favicon.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons. Uncomment required icon fonts -->
    <link rel="stylesheet" href="../assets/vendor/fonts/boxicons.css" />
 
    <!-- Core CSS -->
    <link rel="stylesheet" href="../assets/vendor/css/core.css" class="template-customizer-core-css" />
    <link rel="stylesheet" href="../assets/vendor/css/theme-default.css" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="../assets/css/demo.css" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />

    <link rel="stylesheet" href="../assets/vendor/libs/apex-charts/apex-charts.css" />

    <!-- Page CSS -->

    <!-- Helpers -->
    <script src="../assets/vendor/js/helpers.js"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="../assets/js/config.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.css">
  
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.js"></script>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->
 {{ parent() }}
  
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

         
          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->

            <div class=" flex-grow-1 tabMission ">
              <div class="row">
                  <!-- Contextual Classes -->

              <!-- <div class="card" style="height: 792px;margin-top:-3px;"> -->
                {# <h5 class="card-header ">Liste des Missions <div style="margin-left: 940px;font-size: 15px;" class="form-check form-check-inline mt-3">
                            <input
                              class="form-check-input"
                              type="radio"
                              name="inlineRadioOptions"
                              id="inlineRadio1"
                              value="option1"
                            />
                            <label class="form-check-label" for="inlineRadio1">Aujourdui</label>
                          </div>
                          <div style="font-size: 15px;" class="form-check form-check-inline">
                            <input
                              class="form-check-input"
                              type="radio"
                              name="inlineRadioOptions"
                              id="inlineRadio2"
                              value="option2"
                            />
                            <label class="form-check-label" for="inlineRadio2">tous</label>
                          </div>
                        
                          <div class="btn-group "style="right:0">
                            <button type="button" class="btn btn-primary btn-icon rounded-pill dropdown-toggle hide-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                              <i class="bx bx-dots-vertical-rounded"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" style="">
                                <li ><a  class="dropdown-item editer" ><i class="menu-icon tf-icons bx bx-edit"></i>Exporter</a></li>
                                <li><a  class="dropdown-item" type="button"
                                
                                  data-bs-toggle="modal"
                                  data-bs-target="#modalScrollable" ><i class="menu-icon tf-icons bx bx-folder-plus"></i>Demmander Mission</a></li> #}
                                <!-- <li>
                                  <hr class="dropdown-divider">
                                    </li>
                                <li><a  class="dropdown-item"><i class="menu-icon tf-icons bx bx-check-square"></i>Valider</a></li> -->
                            </ul>
                          </div>
                        </h5>
                      <div class="card">
                    <h5 class="card-header">Liste des Missions </h5>
                     {% set role = app.session.get('ROLES') %}
                   <div class="btn-group" style="right: 18px;top: 14px;position:absolute;">
                          <button type="button" style="border: 0;background-color: transparent;" class=" btn-icon rounded-pill dropdown-toggle hide-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bx bx-dots-vertical-rounded" style="top: 76px;right: 50px; font-size: 1.5rem;"></i>
                          </button>
                          <ul class="dropdown-menu dropdown-menu-end" style="position: absolute;inset: 0px 0px auto auto;margin: 0px;top: -20px !important;right: 36px;">
                           {% if role == "ROLE_USER" %}
                              <li ><a  class="dropdown-item demander"  ><i class="menu-icon tf-icons bx bx-folder-plus" data-bs-toggle="modal" data-bs-target="#modalScrollable"></i>Demander</a></li>
                              
                              <li>
                                <hr class="dropdown-divider">
                                  </li>
                              <li><a  class="dropdown-item btnfiltre" data-id="1"><i class="menu-icon tf-icons bx bx-folder-plus"></i>Creer</a></li>
                               <li><a  class="dropdown-item btnfiltre" data-id="2"><i class="menu-icon tf-icons bx bx-folder"></i>Initier</a></li>
                              <li><a  class="dropdown-item btnfiltre" data-id="3"><i class="menu-icon tf-icons bx bx-check-square"></i>Valider</a></li>
                              {% endif %}
                                 {% if role == "ROLE_ADMIN" %}
                              <li><a  class="dropdown-item btnfiltre" data-id="1"><i class="menu-icon tf-icons bx bx-folder-plus"></i>Creer</a></li>
                              <li><a  class="dropdown-item btnfiltre" data-id="2"><i class="menu-icon tf-icons bx bx-folder"></i>Initier</a></li>
                              <li><a  class="dropdown-item btnfiltre" data-id="3"><i class="menu-icon tf-icons bx bx-check-square"></i>Valider</a></li>
                              {% endif %}
                          </ul>
                        </div>
                    <hr class="my-0" />
                    <div class="card-body">
                    
                                        
<table id="table_id" class="display compact tbodymissionfiltre">
    <thead>
        <tr style="background:#e7e7ff;text-align:center;">
            <th>#</th>
            <th>id</th>
            <th>Site </th>
            <th>Demandeur</th>
            <th>Date Mission</th>
            <th>Date debut</th>
            <th>Date fin</th>
            <th>Heure</th>
            <th>Npt</th>
            <th>status</th>
            <th>Action</th>
            <th hidden>Action</th>
        </tr>
    </thead>
    <tbody id="data_table" class="tabrow tbodymissionfiltre">
  {% set count = 0 %}
    {% for item in mission %}
    {% set count = count + 1 %}
   
        <tr style="text-align:center">
            <td style="width:2%">{{count}} </td>
            <td>{{item.idm}}</td>
            <td style="text-align: left;">{{item.abreviation}}</td>
            <td>{{item.benificiare}}</td>
            <td>{{item.date_mission | date('Y-m-d')}} </td>
            <td> {{item.date_depart | date('Y-m-d')}}  </td>
            <td> {{item.date_retour | date('Y-m-d')}}</td>
            <td> {{item.heure_depart}}  </td>
            <td> {{item.nb_personnes	}}  </td>
            <td >{% if item.statut_id == 1  %} 
            <span class="badge bg-label-info">Creer</span>
             {% elseif item.statut_id == 2 %}<span class="badge bg-label-primary">Initier</span>
             {% elseif item.statut_id == 4 %}<span class="badge bg-label-danger">Annule</span>
             {% else %}
             <span class="badge bg-label-success me-1">Valider</span>
             {% endif %}</td>
            <td hidden>{% if item.statut_id == 1  %}1{% elseif item.statut_id == 2 %}2{% else %}3{% endif %}</td>
            {# <td>
           {{item.statut}}
          </td> #}
            <td style="width:2%">
                        <div class="btn-group">
                          <button type="button" style="border: 0;background-color: transparent;" class=" btn-icon rounded-pill dropdown-toggle hide-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bx bx-dots-vertical-rounded"></i>
                          </button>
                          <ul class="dropdown-menu dropdown-menu-end" style="">
                          
                          
                              <li ><a  class="dropdown-item editer" at="{{item.idm}}" ><i class="menu-icon tf-icons bx bx-edit"></i>Editer</a></li>
                               {% if role == "ROLE_ADMIN" %}
                              {% if item.statut_id == 1  %}
                              <li><a  class="dropdown-item initier" at="{{item.idm}}" ><i class="menu-icon tf-icons bx bx-folder-plus"></i>Initier</a></li>
                              {% else %}
                                <li><a  class="dropdown-item initier" at="{{item.idm}}"><i class="menu-icon tf-icons bx bx-folder-plus"></i>initier</a></li>
                              {% endif %}
                              <li>
                                <hr class="dropdown-divider">
                                  </li>
                              <li><a  class="dropdown-item valider" at="{{item.idm}}"><i class="menu-icon tf-icons bx bx-check-square"></i>Valider</a></li>
                               {% if item.statut_id == 4  %}
                             <li><a  class="dropdown-item bg-dark" at="{{item.idm}}"><i class="menu-icon tf-icons bx bx-check-square"></i>Annule</a></li>
                              {% else %}
                               <li><a  class="dropdown-item annuler" at="{{item.idm}}"><i class="menu-icon tf-icons bx bx-check-square"></i>Annuler</a></li>
                              {% endif %}
                              
                              {% endif %}
                          </ul>
                        </div>
                             </td>
        </tr>
      {% endfor %}
    </tbody>
</table>
                    <!-- /Account -->
                  </div>

                {# <div class="table-responsive text-nowrap"> #}
   

               
  </div>
              <!--/ Contextual Classes -->
                


                </div>
              
            
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- <div class="buy-now">
      <a
        href="https://themeselection.com/products/sneat-bootstrap-html-admin-template/"
        class="btn btn-danger btn-buy-now"
         type="button"
                          class="btn btn-primary"
                          data-bs-toggle="modal"
                          data-bs-target="#modalScrollable"
        >Demander Mission</a
      >
    </div> -->


                

  <!-- Modal -->
                      <div class="modal fade" id="modalScrollable" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-scrollable" role="document">
                          <div class="modal-content" style="width: 1530px;right: 236px;">
                            <div class="modal-header">
                              <h5 class="modal-title" id="modalFullTitle">DEMANDER UNE MISSION</h5>
                                <button
                                  type="button"
                                  class="btn-close"
                                  data-bs-dismiss="modal"
                                  aria-label="Close"
                                ></button>
                            </div>
                           
                 <div class="modal-body" style="padding: 0.5rem 1rem 1rem 0.5rem;">
                               <div class="card mb-4" style="box-shadow:none;">
                                  <h5 class="card-header" style="background: #d3dcf3;">LES DONNÉES DU CLIENT :</h5>
                                  <!-- Account -->
                              
                                  <hr class="my-0" />
                                  <div class="card-body">


                                    <form id="formAccountSettings" method="POST"  >
                                      <div class="row">
                               
                          {% set abrev = app.session.get('desc') %}
                          <div class="mb-3 col-md-4">
                            <label for="lastName" class="form-label">Site</label>
                            {% set filter = app.session.get('iddossier') %}
                             
                   
                            
                          
                            <input class="form-control txtsite" type="text" name="lastName" data-id="{{filter}}" id="lastName" value="{{abrev}}" readonly/>
                          
                          </div>
                            <div class="mb-3 col-md-2">
                            <label for="lastName" class="form-label">Demandeur</label>
                            <input class="form-control txtDemandeur" type="text" name="lastName" id="lastName" value="Demandeur" />
                          </div>
                            <div class="mb-3 col-md-2">
                            <label for="lastName" class="form-label">bénéficiaire</label>
                            <input class="form-control txtBenif" type="text" name="lastName" id="lastName" value="bénéficiaire" />
                          </div>
                          <div class="mb-3 col-md-2">
                            <label for="email" class="form-label">nbr des personnes</label>
                            <input
                              class="form-control nptTxt"

                              type="number" 
                             
                             
                            />
                          </div>

                          <div class="mb-3 col-md-2">
                            <label for="organization" class="form-label">Ville de destination :</label>
                            <input
                              type="text"
                              class="form-control txtVille"
                             
                            />
                          </div>
                          <div class="mb-3 col-md-2">

                            <label class="form-label" for="phoneNumber">Numero Tel :</label>
                            <div class="input-group input-group-merge">
                              
                              <input
                                type="text"
                                id="phoneNumber"
                                name="phoneNumber"

                                class="form-control txtNum"

                                placeholder="662725090"
                              />
                            </div>
                          </div>

                          <div class="mb-3 col-md-4">
                            <label for="address" class="form-label">Address :</label>
                            <input type="text" class="form-control txtAdress" id="address" name="address" placeholder="Address" />
                          </div>
                          <div class="mb-3 col-md-2">
                            <label for="state" class="form-label">Date depart : </label>
                             <input
                            class="form-control dtpDepart"
                            type="date"
                            value="2021-06-18"
                            id="html5-datetime-local-input"
                          />
                          </div>
                          <div class="mb-3 col-md-2">
                            <label for="zipCode" class="form-label">Date retour : </label>
                            <input
                            class="form-control dtpRetour"
                            type="date"
                            value="2021-06-18"
                            id="html5-datetime-local-input"
                          />
                          </div>
                          <div class="mb-3 col-md-2">
                            <label class="form-label" for="country">Heure :</label>
                          <input class="form-control txtHeure" type="time" value="12:30:00" id="html5-time-input" />
                          </div>
                         
                            
                         
                         
                           {# <div id="defaultFormControlHelp" class="form-text">
                          NPT : Nombre des personnes à transporter

                        </div> #}

                         
                         
                         
                        </div>
                      
                      </form>
                     </div>
                    <!-- /Account -->
                  {# </div>
                  <div class="card mb-3" style="height:400px;"> #}
                    {# <h5 class="card-header" style="background: #d3dcf3;">CHOIX DES PRESTATIONS :</h5> #}
                    <!-- Account -->
                    {# <label for="" class="idDemandeM"></label> #}
                    <hr class="my-0" />
                    <div class="card-body">
                      <form id="formAccountSettings" method="POST" onsubmit="return false">
                        <div class="row">
                            
                         
                         <div class="mb-3 col-md-3">
                            <label for="Site" class="form-label">Type du prestation: </label>
                          
                                 <select id="country" class="select2 DDLtypeprestation form-select">
                              <option value="">Type Prestation</option>
                              {% for item in typePrestation %}
                                 <option value="{{item.id}}">{{item.designation}}</option>
                              {% endfor %}
                             
                            </select>

                          </div>
                       
                          <div class="mb-3 col-md-3">
                            <label for="Site" class="form-label">Prestation</label>
                          
                                 <select id="country" class="select2 DDLprestation form-select">
                                <option value="">Prestation</option>
                              
                             
                            </select>

                          </div>
                          <div class="mb-3 col-md-3">
                            <label for="Site" class="form-label">Type du véhicule: </label>
                          
                                 <select id="country" class="select2 DDLtypevehicule form-select">
                              <option value="">Type Vehicule</option>
                            
                             
                            </select>

                          </div>
                          <div class="mb-3 col-md-3">
                            <label for="Site" class="form-label"></label>
                          
                                 <button type="button"  class="btn btn-outline-primary btnajouterprestation" style="margin-top: 30px;">
                              <span class="tf-icons bx bx-book-add"></span>&nbsp; Ajouter Prestation
                            </button>

                         
                          </div>

                        </div>
                      
                    
                          <div class="spacetable" >

                             <table class="table table-bordered ">
                    <thead>
                      <tr style="background: #d3dcf3;">
                      
                        <th>Type Prestation</th>
                        <th>Prestation</th>
                        <th>Type Vehicule</th>
                        <th>#</th>
                       
                      </tr>
                    </thead>
                              <tbody class="table-border-bottom-0 tbodylisteprestation" >
                                <tr class="table-default">
                                 
                                </tr>
                             
                              
                              </tbody>
                            </table>

                         
                          
                        </div>
                      </form>
                    </div>

                    <!-- /Account -->
                  </div>
                              </div>

                           
                              <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                  Close
                                </button>
                                <button type="submit" class="btn btn-primary addMission">Save changes</button>
                              </div>
                           
                            </div>
                          </div>
                        </div>
    <!-- Core JS -->


    <!-- Modaal -->
  
  <!-- Modal -->
                        <div class="modal fade edit_demande" id="modalScrollable_edite" tabindex="-1" aria-hidden="true">
                        
                            <div class="modal-dialog modal-dialog-scrollable" role="document">
                                                      <div class="modal-content" style="width: 1530px;right: 409px;">
                                                        <div class="modal-header">
                                                          <h5 class="modal-title" id="modalFullTitle">EDITER MISSION</h5>
                                                            <button
                                                              type="button"
                                                              class="btn-close"
                                                              data-bs-dismiss="modal"
                                                              aria-label="Close"
                                                            ></button>
                                                        </div>
                                                                                    <div class="modal-body" id="modal_edit">

                       

                           </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                  Close
                                </button>
                                <button type="submit" class="btn btn-primary EditerMission">Edit changes</button>
                              </div>
                           
                            </div>
                          </div>
                          </div>
    <!-- END -->

    <!-- Modal -->
                        <div class="modal fade" id="modalScrollable_initiation" tabindex="-1" aria-hidden="true">
                        
                            <div class="modal-dialog modal-dialog-scrollable" role="document">
                                                      <div class="modal-content" style="width: 1530px;right: 409px;">
                                                        <div class="modal-header">
                                                          <h5 class="modal-title" id="modalFullTitle">INITIER MISSION</h5>
                                                            <button
                                                              type="button"
                                                              class="btn-close"
                                                              data-bs-dismiss="modal"
                                                              aria-label="Close"
                                                            ></button>
                                                        </div>
                                                                                    <div class="modal-body" id="modal_initiation">

                       

                           </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                  Close
                                </button>
                                <button type="submit" class="btn btn-primary Intier_mission">initier Mission</button>
                              </div>
                           
                            </div>
                          </div>
                          </div>
    <!-- END -->
    <!-- Modal -->
                        <div class="modal fade" id="modalScrollable_validation" tabindex="-1" aria-hidden="true">
                        
                            <div class="modal-dialog modal-dialog-scrollable" role="document">
                                                      <div class="modal-content" style="width: 1530px;right:409px;">
                                                        <div class="modal-header">
                                                          <h5 class="modal-title" id="modalFullTitle">Valider Mission</h5>
                                                          <button type="button"class="btn-close"data-bs-dismiss="modal"aria-label="Close"></button>
                                                        </div>
                            <div class="modal-body" id="modal_validation">

                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                  Close
                                </button>
                                <button type="submit" class="btn btn-primary valider_miss">valider Mission</button>
                              </div>
                           
                            </div>
                          </div>
                          </div>
    <!-- END -->

 
         <link href="//cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css">
<script src="//cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
$(document).ready( function () {

  
    var tableData = [];

    var tableData3 = [];
    var prestationvalider = [];
    var prestationinitier = [];
    /////////////////table //////////////////////////////
    $('#modalScrollable_initiation').on('hidden.bs.modal', function () {
    prestationinitier = [];

  })
   var prestationvalider = [];
  
  $('#modalScrollable_validation').on('hidden.bs.modal', function () {
    prestationvalider = [];

  })
$("body").on("click" , "#defaultCheck1" , function() {
    
    if($(this).is(':checked')){

        tableData = $(this).closest("tr").children("td").map(function () {
            return $(this).text();
          }).get();

    //   alert($('#'+tableData[0]+'vehiselect').val()); 
    //   alert($('#'+tableData[0]+'condselect').val()); 
      if ( typeof $('#'+tableData[0]+'condselect').val() === 'undefined') {
        var conducteur = 0;
      }
      else{
        var conducteur = $('#'+tableData[0]+'condselect').val();
      }
      if (typeof $('#'+tableData[0]+'vehiselect').val() ==='undefined') {
        var vehicule = 0;
      }
      else{
        var vehicule = $('#'+tableData[0]+'vehiselect').val();
      }
      if (typeof $('#'+tableData[0]+'kilo').val() ==='undefined') {
        var kilometrage = 0;
      }
      else{
        var kilometrage = $('#'+tableData[0]+'kilo').val();
      }
    
     
      prestationinitier.push({"idrelation_mission": tableData[0],"idprestation":tableData[1],"kilometrage":kilometrage,"conducteur":conducteur,"vehicule":vehicule});

     }
     else{
        console.log(prestationinitier.length);
        if (prestationinitier.length == 1) {
             prestationinitier = [];
        }
        else{
            let idpr = prestationinitier => prestationinitier.idprestation == tableData[1];
            
             prestationinitier = prestationinitier.filter(idpr);
        }

      
    
     }
     console.log(prestationinitier);
});

$("body").on("click" , "#validecheckbox" , function() {
  tableData3 = $(this).closest("tr").children("td").map(function () {
            return $(this).text();
          }).get();

    if($(this).is(':checked')){

    
    //   alert(tableData3[1]);
        
      prestationvalider.push({"idrelation_mission": tableData3[1],"carburant":$(this).closest("tr").find('.carburant').val(),"jawaz":$(this).closest("tr").find('.jawaz').val(),"remise":$(this).closest("tr").find('.remise').val(),"nbrj":$(this).closest("tr").find('.nbrj').val()});

    }
    else{

        if (prestationvalider.length == 1) {
             prestationvalider = [];
        }
        else{
          console.log(tableData3[1]);
            let idpre = prestationvalider => prestationvalider.idrelation_mission != tableData3[1];
            console.log(idpre);

             prestationvalider = prestationvalider.filter(idpre);
        }
    }
    console.log(prestationvalider);
               });



    $('body').on('click', '.tabrow tr',function () {
    
         tableData = $(this).children("td").map(function () {
              return $(this).text();
            }).get();
    
    });

    $('#table_id').DataTable({
    pageLength : 15,
    lengthMenu: [[15, 30, 35, -1], [15, 30, 45]]
  })

$(".demander" ).click(function() {
    $('#modalScrollable').modal('toggle');
    $('#modalScrollable').modal('show');
});


$(".creer" ).click(function() {

     $.ajax({
                         type: "post",
                         url:'/filter',
                          data:{
                              'action':'creer',
                          },
                         success:function(data) {
                          $('#table_id').clear();
                           $('#table_id').html(data);
                            $('#table_id').DataTable({
    pageLength : 15,
    lengthMenu: [[15, 30, 35, -1], [15, 30, 45]]
  }) 

                          }
                     })
});


$('body').on('click','.editer',function () {

   if(tableData[10] == '1'){
       $('#modalScrollable_edite').modal('toggle');
    $('#modalScrollable_edite').modal('show');
  var id_mission = $(this).attr('at');
   $.ajax({
                         type: "post",
                         url:'/editermission/'+id_mission,
                          data:{
                              'id_mission':id_mission,
                          },
                         success:function(data) {
                              $('#modal_edit').html(data);
                              console.log(data)
                          }
                     })
    }
   else if(tableData[10] == '2'){
      alert('mission Initier');
    }
   else if(tableData[10] == '3'){
      alert('mission valide');
    }
    
   
               });


    $("body").on("click" , ".initier" , function() {
    $('#modalScrollable_initiation').modal('toggle');
    $('#modalScrollable_initiation').modal('show');
  var id_mission = $(this).attr('at');
   $.ajax({
                         type: "post",
                         url:'/initierMission/'+id_mission,
                          data:{
                              'id_mission':id_mission,
                          },
                         success:function(data) {
                              $('#modal_initiation').html(data);
                              console.log(data)
                          }
                     })
               });



    $("body").on("click" , ".valider" , function() {
    
    var id_mission = $(this).attr('at');
    if(tableData[10] == '2'){
      $('#modalScrollable_validation').modal('toggle');
    $('#modalScrollable_validation').modal('show');
       $.ajax({
                          type: "post",
                          url:'validerMission/'+id_mission,
                            data:{
                                'id_mission':id_mission,
                            },
                          success:function(data) {
                                $('#modal_validation').html(data);
                                console.log(data)
                            }
                      })
    }
    else if(tableData[10] == '3'){
      alert('mission valide');
    }
    else{
     alert('Prière de initier la mission');

    }
   
                });


//     $("body").on("click" , ".valider_miss" , function() {

//   prestationvalider.forEach(obj => {
  
//       $.ajax({
//                          type: "post",
//                          url:'/validermission_v2/'+obj.idrelation_mission,
//                           data:{
//                               'idrelation_mission':obj.idrelation_mission,
//                               'carburant':obj.carburant,
//                               'jawaz':obj.jawaz,
//                               'remise':obj.remise,
//                               'nbrj':obj.nbrj,
//                           },
//                          success:function(data) {
//                             $('#modalConfirmationvalidation').modal('hide');
//                             $('#modalConfirmationvalidation').modal();
//                             $('body #'+data).closest('tr').remove();

                            
//                           }
//                      })
//                                      });
   

// });
    $("body").on("click" , ".valider_miss" , function() {
  var id_mission = $('#valider_mission').attr('at');
   let prestation =$('.DDLprestation_2 option:selected').text();
   let nbrrow= $('.tbodylisteprestation_3 tr > td:contains('+prestation+') ').length;
//   alert(nbrrow);
//   alert(id_mission);
if(nbrrow == 0) {

  Swal.fire({
  title: 'êtes-vous sûr?',
  icon: 'warning',
  showCancelButton: true,
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'oui, valider!'
}).then((result) => {
  if (result.isConfirmed) {
    $.ajax({
                          type: "post",
                          url:'validermission_f/'+id_mission,
                            data:{
                                'id_mission':id_mission,
                            },
                          success:function(data) {
                            $('#modalScrollable_validation').modal('hide');
                             Swal.fire(
                                'Valider!',
                                'Votre mission a été validée.',
                                'success'
                              )
                               window.location.reload();


                            }
                      })
   
  }
})

}
else{
   prestationvalider.forEach(obj => {
  
       $.ajax({
                         type: "post",
                         url:'/validermission_v2/'+obj.idrelation_mission,
                          data:{
                              'idrelation_mission':obj.idrelation_mission,
                              'carburant':obj.carburant,
                              'jawaz':obj.jawaz,
                              'remise':obj.remise,
                              'nbrj':obj.nbrj,
                          },
                         success:function(data) {
                            $('#modalConfirmationvalidation').modal('hide');
                            $('#modalConfirmationvalidation').modal();
                            $('body #'+data).closest('tr').remove();

                            
                          }
                     })
                                     });
}
  
  
  
      
                });
                $('body').on('click','.EditerMission',function () {
   
     let idmiss =$('.txtsite_').attr('at');
     let demandeur =$('.txtDemandeur_').val();
     let benif =$('.txtbenif_').val();
    var nbrP =$('.nptTxt_').val();
    let ville =$('.txtVille_').val();
    let numTel =$('.txtNum_').val();
    let adresse =$('.txtAdress_').val();
    let dateDepart =$('.dtpDepart_').val();
    let dateRetour =$('.dtpRetour_').val();
    let Heure =$('.txtHeure_').val();

     $.ajax({
                      type: "POST",
                      url:'/editermissions',
                       data: {
                           'idmission':idmiss,
                           'demandeur' : demandeur,
                           'benif' : benif,
                           'nbrP' : nbrP,
                           'ville' : ville,
                           'numTel' : numTel,
                           'adresse' : adresse,
                           'dateDepart' : dateDepart,
                           'dateRetour' : dateRetour,
                           'Heure' : Heure
                        
                       },
                      success:function(data) {


                         }
                            }) 
                });
                  $("body").on("click" , ".validerprestation" , function() {
                    //   alert('ok')
                    //   $("#modal_validation").modal();
                      $('#modalConfirmationvalidation input').val('');
                  });
                  
                  
                         $("body").on("click" , ".Intier_mission" , function() {

                    //    var getselect =$(".initiertable input:checked").parents("tr").map(function () {
                    //     return $(this).text();
                    //   }).get();
                    //    console.log(getselect);
                    //    alert(getselect);
               console.log(prestationinitier);
                var idmissioncab = $('.lblidmissioncab').val();
                // alert(idmissioncab);
                // var idrelationmission = $(this).attr('data-id');
                 let prestation =$('.DDLprestation_2 option:selected').text();

                let nbrrow= $('.tbodylisteprestation_3 tr > td:contains(Faut initier) ').length;
                let nbrrow2= $('.tbodylisteprestation_3 tr > td:contains('+prestation+') ').length;

                prestationinitier.forEach(obj => {

                    $.ajax({
                        type: "post",
                        url:'/confirmerInitiation/'+obj.idrelation_mission,
                        data:{
                            // 'idrelation_mission':idrelationmission,
                            'idvehicule':obj.vehicule,
                            'idconducteur':obj.conducteur,
                            'kilometrage':obj.kilometrage,
                            'idrelationmission':obj.idrelation_mission,
                        },
                        success:function(data) {
                            console.log(data);
                            $('#modalScrollable_initiation').modal('hide');
                            // location.href="http://127.0.0.1:8000/etatInitier/"+data;
                            $('body #'+obj.idrelation_mission).closest('tr').remove();

                            window.open('/etatInitier/'+data);
                        }
                    })

                                     });
                
                // let nbrrow= $('.tbodylisteprestation tr > td:contains('+prestation+') ').length;
                // alert(nbrrow)
                // if(nbrrow==0 || nbrrow2==0){
                    $.ajax({
                        type: "post",
                        url:'/initiermissioncab/'+idmissioncab,
                        data:{
                       
                        },
                        success:function(data) {
                            if (data == "yes") {
                                location.href="/mission";
                            }
                            else{}
                            console.log(data);
                            
                            // $('body #'+data).closest('tr').remove();
                            $('#modalScrollable_edite').modal('hide');
                            // window.reload();


                           
                        }
                    })
                // }
                // else{
                //     alert("Veuillez initier tous les prestations");
                // }
              
               

                // $.ajax({
                //                         type: "post",
                //                         url:'/initiermissioncab/'+idmissioncab,
                //                         data:{
                                       
                //                         },
                //                         success:function(data) {
                //                             console.log(data);
                //                             $('#modalScrollable_edite').modal('hide');
                //                             location.href="http://127.0.0.1:8000/mission/";
                                           
                //                         }
                //                     })

                            });
                            
                            $("body").on("click" , ".validerprestation_f" , function() {


                prestationvalider.forEach(obj => {
  
       $.ajax({
                         type: "post",
                         url:'/validermission_v2/'+obj.idrelation_mission,
                          data:{
                              'idrelation_mission':obj.idrelation_mission,
                              'carburant':obj.carburant,
                              'jawaz':obj.jawaz,
                              'remise':obj.remise,
                              'nbrj':obj.nbrj,
                          },
                         success:function(data) {
                            $('#modalConfirmationvalidation').modal('hide');
                            $('#modalConfirmationvalidation').modal();
                            $('body #'+data).closest('tr').remove();

                            
                          }
                     })
                                     });

               });
                            
//                                 $("body").on("click" , ".Intier_mission" , function() {
// alert('ok')
//                 var idmissioncab = $('.lblidmissioncab').val();
               
              
//                  let prestation =$('.DDLprestation_2 option:selected').text();

//                 let nbrrow_= $('.tbodylisteprestation_3 tr > td:contains(Faut initier) ').length;
//                 let nbrrow_2= $('.tbodylisteprestation_3 tr > td:contains('+prestation+') ').length;

                
//                 // let nbrrow= $('.tbodylisteprestation tr > td:contains('+prestation+') ').length;
//                 alert(nbrrow_);
//                 if(nbrrow==0 || nbrrow2==0){
                   
//                 }
//                 else{
//                     alert("Veuillez initier tous les prestations");
//                 }
              
               

              

//                             });

   

});







</script>
    <!-- build:js assets/vendor/js/core.js -->
    {# <script src="../assets/vendor/libs/jquery/jquery.js"></script> #}
    {# <script src="../assets/vendor/libs/popper/popper.js"></script> #}
    <script src="../assets/vendor/js/bootstrap.js"></script>
    <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

    <script src="../assets/vendor/js/menu.js"></script>
    <!-- endbuild -->

    <!-- Vendors JS -->
    <script src="../assets/vendor/libs/apex-charts/apexcharts.js"></script>

    <!-- Main JS -->
    <script src="../assets/js/main.js"></script>

   
    <script src="{{ asset('js/script5.js') }}"></script>
              {# <script src="{{ asset('js/jquery.min.js') }}"></script>
             <script src="{{ asset('js/jquery.dataTables.min.js') }}"></script>
              <script src="{{ asset('js/jquery-3.5.1.js') }}"></script>
              <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> #}

    <!-- Page JS -->
    <script src="../assets/js/dashboards-analytics.js"></script>

    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
  </body>
</html>

{% endblock %}
